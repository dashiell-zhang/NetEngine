@page "/"
@using Application.Model.Site.Site
@attribute [ReuseTabsPage(Title = "仪表盘", PinUrl = "/", Closable = false, Pin = true)]

<Card Title="服务器信息">
    @foreach (var info in serverInfos)
    {
        <CardGrid Style="width:25%;text-align:left" Hoverable="true">
            @(info.Name + "：" + info.Value)
        </CardGrid>
    }
</Card>

@code {

    List<ServerInfoDto> serverInfos = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            using var response = await Http.GetAsync("Site/GetServerInfo");
            if (!response.IsSuccessStatusCode)
            {
                return;
            }

            var retData = await response.Content.ReadFromJsonAsync<List<ServerInfoDto>>(JsonHelper.DeserializeOpts);
            if (retData != null)
            {
                serverInfos = retData;
            }
        }
        catch (OperationCanceledException)
        {
            // ignore
        }
        catch (HttpRequestException)
        {
            // interceptor handles 401/400; don't crash WASM runtime
        }
    }

}
